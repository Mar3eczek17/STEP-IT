# Telegram Bot with Flask and Webhook

This project is a simple Telegram bot built using `python-telegram-bot`, `Flask`, and webhook integration. The bot replies to the `/start` command and echoes any messages sent to it.

## Prerequisites

Before you start, ensure you have the following installed:

- Python 3.12 or later
- Flask
- python-telegram-bot
- ngrok (for local development with webhooks)

You can install the required Python packages by running:

```bash
pip install -r requirements.txt
```

If you don't have a `requirements.txt` file yet, you can create one by running the following command in your project directory:

```bash
pip freeze > requirements.txt
```

## Setting Up the Bot

### 1. Create a Bot on Telegram
- Open the Telegram app and search for the **BotFather**.
- Start a chat and use the command `/newbot` to create a new bot.
- Follow the instructions to set a name and username for your bot.
- Copy the **API token** provided by the BotFather (you'll need this in your code).

### 2. Set Up `.env` File

Create a `.env` file in the root directory of your project. Add the following content to it:

```
YOUR_TOKEN=your_telegram_bot_token
```

Replace `your_telegram_bot_token` with the token you received from the BotFather.

### 3. Configure ngrok (for local testing)

For local testing, you can use ngrok to expose your local server to the web.

1. Install ngrok from [https://ngrok.com/download](https://ngrok.com/download).
2. After installing, run the following command in your terminal to expose port 5000 (Flask default):

```bash
ngrok http 5000
```

Ngrok will provide you with a public URL (e.g., `https://xyz123.ngrok.io`). You’ll need to use this URL when setting up the webhook.

### 4. Set Up Webhook

After starting ngrok, you need to set the webhook with Telegram's API. In your Flask app (`username_bot.py`), make sure to replace `'YOUR_TOKEN'` with the actual token from your `.env` file.

Add the following code to configure the webhook:

```python
import os
import requests
from dotenv import load_dotenv

# Load the environment variables
load_dotenv()

# Get the token from the .env file
TOKEN = os.getenv('YOUR_TOKEN')

# Set the webhook URL with ngrok's public URL
ngrok_url = 'https://xyz123.ngrok.io'  # Replace with your ngrok URL
requests.get(f'https://api.telegram.org/bot{TOKEN}/setWebhook?url={ngrok_url}/webhook')
```

### 5. Running the Bot

To run the bot:

1. **Start ngrok**: Expose your local Flask server by running the following command in your terminal:

    ```bash
    ngrok http 5000
    ```

    This will generate a public URL, which you’ll use in the next step.

2. **Run your Flask app**: In your terminal, run:

    ```bash
    python username_bot.py
    ```

    This will start the Flask server on `http://127.0.0.1:5000`. The bot will be available via the public URL generated by ngrok.

### 6. Interacting with the Bot

- Open the Telegram app and search for your bot using the username you provided to the BotFather.
- Start a conversation with your bot by sending the `/start` command or any other text.
- The bot will reply with a greeting message on `/start` and will echo any other text.

## Troubleshooting

1. **Invalid token error**: Double-check the token in your `.env` file and ensure it's correctly loaded using `load_dotenv()`.
2. **Webhook not working**: Ensure that ngrok is running and that the correct URL is set for the webhook.
3. **Bot not responding**: Make sure your server is running on port 5000 and that ngrok is exposing the correct port.

If you're still facing issues, try restarting your Flask app and ngrok, and check for any error messages in the console.

## License

This project is open source and available under the [MIT License](LICENSE).

---

### Requirements (requirements.txt)

If you prefer, you can create a `requirements.txt` file with the following dependencies:

```
Flask==2.2.3
python-telegram-bot==21.10
requests==2.28.2
python-dotenv==1.0.0
```

This file covers all the dependencies you'll need to run the Telegram bot.

---

### Additional Notes

- **ngrok Version Update**: Ensure you're using the latest version of ngrok. If you encounter issues with ngrok, check [here](https://ngrok.com/download) for the latest version.
- **.env File and Git**: If you're using Git, make sure to add your `.env` file to `.gitignore` to avoid accidentally sharing your bot's token. Create a `.gitignore` file if it doesn't exist and add the following line:

```
.env
```